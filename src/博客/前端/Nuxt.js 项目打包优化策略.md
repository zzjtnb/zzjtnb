---
title: NUXTé¡¹ç›®æ‰“åŒ…ä¼˜åŒ–ç­–ç•¥
category: å‰ç«¯
tags:
  - Nuxt.js
cover: https://images.unsplash.com/photo-1516918526298-eecb26841edc?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjI5MzI0fQ&auto=format&fit=crop&w=1440&q=80
---

ç”¨ nuxt å¼€å‘å®Œé¡¹ç›®ä¹‹åï¼Œå¼€å¼€å¿ƒå¿ƒæ‰“åŒ…æ‰”ä¸ŠæœåŠ¡å™¨å‡†å¤‡æ”¶å·¥ï¼Œå´æ²¡å¤šä¹…ï¼Œæµ‹è¯•ç«¥é‹é—æ†¾çš„å‘Šè¯‰æˆ‘ï¼Œå‹æµ‹ 50 å¹¶å‘æœªé€šè¿‡ã€‚whatï¼Ÿå¥½å§ã€‚å’±ä»¬å†æ¥ä¸‹æ¥è€è€å®å®çš„ç ”ç©¶æ€ä¹ˆå‹ç¼©æ‰“åŒ…ä¼˜åŒ–æ€§èƒ½ã€‚

æ€§èƒ½ä¼˜åŒ–ï¼Œæ— å¤–ä¹é‚£å‡ ä¸ªæ–¹æ¡ˆï¼šæ–‡ä»¶å‹ç¼©ï¼Œæ–‡ä»¶ç¼“å­˜ï¼ŒCDNï¼ŒDNS é¢„è§£æã€‚ã€‚ã€‚

è¿™é‡Œæˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ä¸åŠ ä»»ä½•ä¼˜åŒ–çš„é¡¹ç›®ï¼Œæ‰“åŒ…åçš„åˆ†å¸ƒï¼š

![16268329-4b7c054e99690b2d](http://upload-images.jianshu.io/upload_images/16268329-4b7c054e99690b2d.png)

## æœªä¼˜åŒ–

**

è¿™é‡Œèƒ½çœ‹åˆ° element-ui å äº†ç»å¤§éƒ¨åˆ†çš„æ‰“åŒ…ç©ºé—´ï¼Œæ˜¯å› ä¸ºå…¨å±€å¼•å…¥äº† element-uiï¼Œæ‰€ä»¥å³ä½¿æˆ‘ä»¬åªä½¿ç”¨äº†ä¸€éƒ¨åˆ†çš„ elemnt ç»„ä»¶ï¼Œä½†ä»ç„¶æŠŠæ•´ä¸ª element ç»™æ‰“åŒ…è¿›æ¥äº†ã€‚

æ‰€ä»¥è¿™é‡Œæœ‰ä¸€ä¸ªå¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼š**åªå¼•å…¥ element ä½¿ç”¨çš„ç»„ä»¶ï¼Œè¿™æ ·åœ¨æ‰“åŒ…çš„æ—¶å€™åªéœ€è¦æ‰“åŒ…ä½¿ç”¨çš„ç»„ä»¶ï¼Œä½“ç§¯å°±ä¼šå‡å°å¾ˆå¤š**ã€‚

![16268329-5fcaaf21e925ebf9](http://upload-images.jianshu.io/upload_images/16268329-5fcaaf21e925ebf9.png) åªå¼•å…¥ä½¿ç”¨çš„ç»„ä»¶

æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¹ˆå¤„ç†ä¹‹åï¼Œæˆ‘ä»¬æ‰“åŒ…å‡ºæ¥çš„æ•ˆæœï¼š

![16268329-8df05dc0fc49f6ff](http://upload-images.jianshu.io/upload_images/16268329-8df05dc0fc49f6ff.png) å¼•å…¥éƒ¨åˆ† elemnet ç»„ä»¶åçš„æ‰“åŒ…åˆ†å¸ƒ

å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å‡å°‘äº†å°†è¿‘ **400kb** çš„ä½“ç§¯ï¼Œæ•ˆæœååˆ†æ˜¾è‘—ã€‚

å¥½äº†ï¼Œæˆ‘åˆè‡ªä¿¡æ»¡æ»¡çš„æŠŠåŒ…ä¸¢åˆ°æœåŠ¡å™¨ä¸Šï¼Œå‡†å¤‡é‡‘ç›†æ´—æ‰‹ã€‚ğŸ˜

ç„¶é¹…æ²¡è¿‡å¤šä¹…ï¼Œè¿ç»´ç«¥é‹å‘è¿‡æ¥ä¸€å¼ å›¾æŠŠæˆ‘æ‰“å›åŸç‚¹ã€‚

![16268329-8f569d3311280e3c](http://upload-images.jianshu.io/upload_images/16268329-8f569d3311280e3c.png) vendor.app.js é˜»å¡äº†

æˆ‘çœ‹äº†ä¸€ä¸‹ vendor.app.jsï¼Œè¶³æœ‰ 501kbï¼Œéš¾æ€ªä¼šé˜»å¡ğŸ¤·â€â™€ï¸å¥½å§ï¼Œè¿™é‡Œåº”è¯¥ä½¿ç”¨ä¸Šæ–‡ä»¶å‹ç¼©è¿™æ†å¤§æªäº†ã€‚

nuxt æœ¬èº«å°±æ˜¯åŸºäº webpack çš„ï¼Œæ­£å¥½å®‰è£… compression-webpack-plugin æ¥å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚

## é¦–å…ˆå®‰è£…

```bash
npm installÂ compression-webpack-plugin
```

## ç„¶ååœ¨ nuxt.config.js ä¸­

```js
const CompressionPlugin = require('compression-webpack-plugin');
module.exports = {
  build: {
    plugins: [
      new CompressionPlugin({
        test: /\.js$|\.html$|\.css/, // åŒ¹é…æ–‡ä»¶å
        threshold: 10240, // å¯¹è¶…è¿‡10kbçš„æ•°æ®è¿›è¡Œå‹ç¼©
        deleteOriginalAssets: false // æ˜¯å¦åˆ é™¤åŸæ–‡ä»¶
      })
    ],
  }
}
```

è¿™æ ·æ‰“åŒ…å‡ºæ¥çš„å¤§å°è™½ç„¶æ²¡å˜ï¼Œä½†æ˜¯ç‚¹å‡». nuxt-dist-client ä¸­ä½ ä¼šå‘ç°

![16268329-37170125d553a6fb](http://upload-images.jianshu.io/upload_images/16268329-37170125d553a6fb.png) æœ‰ gz åç¼€çš„æ–‡ä»¶

è§‚å¯Ÿå‘ç° gz æ‰“åŒ…åï¼Œè¾ƒåŸæ¥çš„æ–‡ä»¶å‡å°‘äº† 3/4 çš„ä½“ç§¯ã€‚æœ‰äº†è¿™äº› gz åç¼€çš„æ–‡ä»¶ï¼Œå†é…åˆ nginx æ‰“å¼€ gzip æœåŠ¡ã€‚æˆ‘æƒ³è¿™å›åº”è¯¥å¯ä»¥å†²è¿‡ 50 å¹¶å‘äº†å§ï¼Œè¯´ä¸å®š 200 å¹¶å‘éƒ½æ²¡é—®é¢˜ğŸ¤©ğŸ¤©ğŸ¤©

å¥½äº†ï¼Œæˆ‘è¿™å›çœŸçš„è‡ªä¿¡æ»¡æ»¡çš„æŠŠåŒ…ä¸¢åˆ°æœåŠ¡å™¨ä¸Šï¼Œé€šçŸ¥æµ‹è¯•ç«¥é‹å†æ¬¡å‹æµ‹ï¼Œæœä¸å…¶ç„¶ï¼Œæµ‹è¯•ç«¥é‹è¿‡äº†ä¸€ä¼šå›å¤ï¼š50 å¹¶å‘è·‘ 5 æ¬¡æ— å¼‚å¸¸ã€‚ğŸ˜ğŸ˜æˆ‘å¤§æ°”è¯´ï¼Œä¸Š 100ï¼æˆ‘ç¿˜ç€å¾—æ„çš„äºŒéƒè…¿ï¼Œç­‰ç€å¥½æ¶ˆæ¯å†æ¬¡åˆ°æ¥ã€‚è¿‡äº†ä¸€ä¼šï¼Œæœä¸å…¶ç„¶ï¼æµ‹è¯•ç«¥é‹å‘Šè¯‰æˆ‘ï¼Œ100 å¹¶å‘é˜»å¡ã€‚åŸå› åŒä¸Šï¼Œå‡ºåœ¨äº† vendor.app.js ä¸ŠğŸ˜­

è¿™é‡Œæˆ‘è¯´ä¸€ä¸‹ vendor.app.js æ‰“åŒ…ä¹‹åçš„ä½“ç§¯æ˜¯ 144kbã€‚ç„¶é¹…åœ¨é«˜å¹¶å‘ä¸‹ï¼Œè¡¨ç°è¿˜æ˜¯ä¸ç†æƒ³ï¼Œäºæ˜¯ä¹æˆ‘åªèƒ½ä¸Šç½‘å»åˆ°å¤„æœç´¢è§£å†³æ–¹æ¡ˆï¼Œæ¯•ç«Ÿ po ä¸»çš„ webpack çŸ¥è¯†ä¹Ÿå°±é‚£ä¹ˆä¸€å‹ºæ°´çš„æ·±åº¦ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸

è¿™é‡Œè¿˜çœŸè®©æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªå°æ¹¾çš„ç½‘ç«™ï¼Œå¯è§å‚è€ƒé“¾æ¥ç¬¬ä¸‰æ¡ã€‚

splitChunks: è¨­å®š Chunks çš„æœ€å¤§å’Œæœ€å° sizeã€‚

## åœ¨ nuxt.config.js ä¸­åŠ å…¥

```js
module.exports = {
  build: {
    optimization: {
      splitChunks: {
        minSize: 10000,
        maxSize: 250000
      }
    },
  }
}

```

## å®Œæ•´

```js
const CompressionPlugin = require('compression-webpack-plugin');
module.exports = {
  build: {
    plugins: [
      new CompressionPlugin({
        test: /\.js$|\.html$|\.css/, // åŒ¹é…æ–‡ä»¶å
        threshold: 10240, // å¯¹è¶…è¿‡10kbçš„æ•°æ®è¿›è¡Œå‹ç¼©
        deleteOriginalAssets: false // æ˜¯å¦åˆ é™¤åŸæ–‡ä»¶
      })
    ],
    optimization: {
      splitChunks: {
        minSize: 10000,
        maxSize: 250000
      }
    },
  }
}
```

## æ¨èä¸‹é¢è¿™æ ·

```js
const CompressionPlugin = require('compression-webpack-plugin');
export default {
  /*
  ** Build configuration
  ** See https://nuxtjs.org/api/configuration-build/
  */
  build: {
    //æå–cssåˆ°å•ç‹¬linkæ–‡ä»¶
    extractCSS: {
      allChunks: true
    },
    postcss: {
      plugins: {
        'postcss-custom-properties': false
      }
    },
    /**
     * You can extend webpack config here
     */
    extend(config, ctx) {
      if (!ctx.isDev && ctx.isClient) {
        config.plugins.push(
          new CompressionPlugin({
            test: /\.js$|\.html$|\.css/, // åŒ¹é…æ–‡ä»¶å
            threshold: 10240, // å¯¹è¶…è¿‡10kbçš„æ•°æ®è¿›è¡Œå‹ç¼©
            deleteOriginalAssets: false // æ˜¯å¦åˆ é™¤åŸæ–‡ä»¶
          }),
        )
        /**
        *  performanceå°±æ˜¯å…³é—­æ¯æ¬¡æ‰“åŒ…ä¹‹åçš„æ–‡ä»¶è¿‡å¤§è­¦å‘Š
        * å…³é—­æ–‡ä»¶è¿‡å¤§æç¤ºï¼Œåˆ©äºæ‰“åŒ…åŠ å¿«é€Ÿåº¦
        */
        config.performance = {
          hints: false,
          //å…¥å£èµ·ç‚¹çš„æœ€å¤§ä½“ç§¯ æ•´æ•°ç±»å‹(int)ï¼ˆä»¥å­—èŠ‚(bytes)ä¸ºå•ä½ 200kï¼‰
          maxEntrypointSize: 204800,
          //ç”Ÿæˆæ–‡ä»¶çš„æœ€å¤§ä½“ç§¯ æ•´æ•°ç±»å‹(int)ï¼ˆä»¥å­—èŠ‚(bytes)ä¸ºå•ä½ 200kï¼‰
          maxAssetSize: 204800,
        }
        /**
         * å…¬å…±ä»£ç æŠ½ç¦»å’Œä»£ç åˆ†å‰²ï¼Œé¿å…å•ä¸ªjsæ–‡ä»¶è¿‡å¤§
         */
        config.optimization = {
          splitChunks: {
            minSize: 10000,
            maxSize: 250000,
            cacheGroups: {
              vendor: {
                chunks: "all",
                test: /node_modules/,
                name: "vendor",
                minChunks: 1,
                maxInitialRequests: 5,
                priority: 100
              },
              common: {
                chunks: "all",
                test: /[\\/]src[\\/]js[\\/]/,
                name: "common",
                minChunks: 3,
                maxInitialRequests: 5,
                priority: 60
              },
              styles: {
                name: "styles",
                test: /\.(sa|sc|c)ss$/,
                chunks: "all",
                enforce: true
              },
              runtimeChunk: {
                name: "manifest"
              }
            }
          }
        }

      }
    },
    // å¼€å¯æ‰“åŒ…åˆ†æ
    analyze: true,
  },
  // performance: {
  //   gzip: false
  // },
}
```

æ‰“åŒ…ï¼Œè§‚å¯Ÿæ‰“åŒ…ç»“æœï¼š

![16268329-cef95899b944ec07](http://upload-images.jianshu.io/upload_images/16268329-cef95899b944ec07.png) splitChunks ä¹‹åçš„æ‰“åŒ…åˆ†æ

å¯ä»¥çœ‹åˆ°è™½ç„¶åŒ…ä½“ç§¯è™½ç„¶æ²¡å˜ï¼Œä½†æ˜¯åƒ vendor.app.js è¿™ç§å•ä¸ªä½“ç§¯å¤§çš„è¢«æ‹†åˆ†æˆ n ä¸ªä½“ç§¯å°çš„æ–‡ä»¶äº†ã€‚

è¿™å›ç»ˆäºæ˜¯å¯ä»¥çªç ´ 100 å¹¶å‘ 5 æ¬¡æ— å¼‚å¸¸ï¼Œè¾¾æˆå¹¶å‘è¦æ±‚äº†ğŸ‰ğŸŠğŸ‰ğŸŠ

æ€»ç»“ä¸€ä¸‹ï¼Œå…¶å® po ä¸»ä¹Ÿä¸æ˜¯ä»€ä¹ˆ webpack å¤§ç¥ï¼Œä¹Ÿæ˜¯æ‘¸çˆ¬æ»šæ‰“æ•´å‡ºæ¥çš„ï¼Œå¤§å®¶å¦‚æœèƒ½æœ‰ä»€ä¹ˆæ›´å¥½çš„ä¼˜åŒ–å»ºè®®æˆ–è€…æŒ‡æ•™ï¼Œè¯·å¤šå¤šäº¤æµï¼Œä¸å¯¹ä¹‹å¤„æˆ‘ä¼šæ”¹æ­£ï¼

å‚è€ƒï¼š

[Nuxt é¡¹ç›®æ€§èƒ½ä¼˜åŒ–è°ƒç ”](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Flessfish%2Fp%2F12411497.html)

[NUXT é¡¹ç›®çš„æ€§èƒ½ä¼˜åŒ–](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fhujinlong%2Fp%2F11088757.html)

[SplitChunks & Lodash & Vuetify tree shaking](https://links.jianshu.com/go?to=https%3A%2F%2Fithelp.ithome.com.tw%2Farticles%2F10207669)
